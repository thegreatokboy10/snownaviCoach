# 人体姿态检测应用

这是一个基于Python的本地运行应用程序，可以对视频文件进行实时人体姿态检测，并显示骨骼关键点。

## 功能特性

- 📹 支持多种视频格式（MP4, AVI, MOV, MKV, WMV, FLV）
- 🦴 实时人体骨骼检测和可视化
- 🎮 视频播放控制（播放/暂停/停止）
- 📊 进度条控制，可跳转到任意时间点
- 🖼️ 并排显示原始视频和姿态检测结果
- 💻 友好的图形用户界面
- 🎨 **自定义骨骼线条样式**（新功能）
  - 7种关键点颜色可选
  - 7种连接线颜色可选
  - 可调节线条粗细（1-8像素）
  - 一键重置默认设置

## 技术栈

- **Python 3.11+**
- **OpenCV** - 视频处理
- **MediaPipe** - 人体姿态检测
- **Tkinter** - 图形用户界面
- **PIL/Pillow** - 图像处理
- **NumPy** - 数值计算

## 安装和运行

### 1. 环境准备

确保你已经创建并激活了虚拟环境：

```bash
# 激活虚拟环境
source pose_detection_env/bin/activate  # macOS/Linux
# 或
pose_detection_env\Scripts\activate     # Windows
```

### 2. 安装依赖

依赖包已经安装在虚拟环境中，包括：
- opencv-python
- mediapipe
- numpy
- pillow

### 3. 运行应用

```bash
python pose_detection_app.py
```

## 使用说明

### 基本操作

1. **选择视频文件**
   - 点击"选择视频文件"按钮
   - 从文件对话框中选择要分析的视频文件
   - 支持的格式：MP4, AVI, MOV, MKV, WMV, FLV

2. **播放控制**
   - **播放/暂停**：点击"播放"按钮开始播放，再次点击暂停
   - **停止**：点击"停止"按钮停止播放并回到开始位置
   - **进度控制**：拖动进度条可以跳转到视频的任意位置

3. **查看结果**
   - 左侧显示原始视频
   - 右侧显示带有人体骨骼关键点的检测结果
   - 底部显示视频信息（文件名、分辨率、帧数、FPS）

4. **自定义骨骼样式**（新功能）
   - **关键点颜色**：从下拉菜单选择关键点的颜色
   - **连接线颜色**：从下拉菜单选择骨骼连接线的颜色
   - **线条粗细**：拖动滑块调整线条粗细（1-8像素）
   - **重置设置**：点击"重置默认"按钮恢复默认样式
   - 可选颜色：红色、绿色、蓝色、黄色、紫色、青色、白色

### 姿态检测说明

应用使用Google MediaPipe的姿态检测模型，可以检测以下关键点：

- 头部：鼻子、眼睛、耳朵
- 躯干：肩膀、肘部、手腕、臀部
- 腿部：膝盖、脚踝、脚部

检测到的关键点会用彩色圆点标记，骨骼连接会用线条绘制。

## 性能优化

### 最新优化 (v2.0)
- **多线程架构**：姿态检测在后台线程进行，不阻塞UI
- **智能帧队列**：使用队列缓冲机制，防止内存溢出
- **优化的播放循环**：使用`tkinter.after()`替代`sleep()`，提高响应性
- **降低模型复杂度**：使用MediaPipe轻量级模型，提高检测速度
- **帧率控制**：智能帧率限制，避免不必要的计算
- **资源管理**：自动清理内存和线程资源

### 性能指标
- 姿态检测：30+ FPS
- 视频读取：2000+ FPS
- 图像处理：5000+ OPS/秒
- UI响应：流畅无卡顿

## 故障排除

### 常见问题

1. **无法打开视频文件**
   - 确保视频文件格式受支持
   - 检查文件是否损坏
   - 尝试使用其他视频文件

2. **姿态检测效果不佳**
   - 确保视频中人物清晰可见
   - 避免过度遮挡或极端角度
   - 光线条件良好的视频效果更佳

3. **播放卡顿**
   - 降低视频分辨率
   - 确保计算机性能足够
   - 关闭其他占用资源的程序

### 系统要求

- **操作系统**：Windows 10+, macOS 10.14+, Linux
- **Python版本**：3.8+
- **内存**：建议4GB以上
- **处理器**：支持AVX指令集的现代CPU

## 开发说明

### 项目结构

```
snownaviCoach/
├── pose_detection_app.py    # 主应用程序
├── requirements.txt         # 依赖包列表
├── README.md               # 说明文档
└── pose_detection_env/     # 虚拟环境目录
```

### 扩展功能

可以考虑添加的功能：
- 导出检测结果为视频文件
- 支持实时摄像头输入
- 添加更多姿态分析指标
- 支持多人检测
- 添加姿态数据导出功能

## 许可证

本项目仅供学习和研究使用。

## 联系方式

如有问题或建议，请通过GitHub Issues联系。
